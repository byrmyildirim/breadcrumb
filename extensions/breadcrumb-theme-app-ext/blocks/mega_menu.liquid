{{ 'mega-menu.css' | asset_url | stylesheet_tag }}

<style>
/* TEMA AKTİF STİLLERİNİ SIFIRLAMA (tüm sayfalarda aktif stil için hazır) */
.mobile-category-bar li .menu-item span,
.mobile-category-bar li.active .menu-item span,
.category-bar li .menu-item span,
.category-bar li.active .menu-item span {
  color: inherit !important;
  font-weight: normal !important;
}
.mobile-category-bar li .menu-item img,
.mobile-category-bar li.active .menu-item img,
.category-bar li .menu-item img,
.category-bar li.active .menu-item img {
  filter: none !important;
}
/* Bizim aktif class'ımız - HER ZAMAN aktif */
.breadcrumb-active-category span {
  color: #e68b59 !important;
  font-weight: 700 !important;
}
.breadcrumb-active-category img {
  filter: invert(72%) sepia(35%) saturate(907%) hue-rotate(335deg) brightness(92%) contrast(89%) !important;
}
</style>


{% assign mobile_settings = shop.metafields.breadcrumb.mobile_menu_settings.value %}
{% assign theme_settings_raw = shop.metafields.breadcrumb.mega_menu_theme_settings.value %}
{% assign theme_settings = empty %}

{% if theme_settings_raw %}
  {% assign theme_settings = theme_settings_raw %}
{% else %}
  {% comment %} Default fallback values {% endcomment %}
  {% assign theme_settings = '{"heightMode": "default", "fixedHeight": 400, "hideDesktop": false, "showGrandchild": false, "expandSubmenus": true, "maxVisibleItems": 5, "menuStyle": "style-default", "displayMode": "push"}' | json_parse %}
{% endif %}

{% assign menu_height_mode = theme_settings.heightMode | default: 'default' %}
{% assign fixed_height = theme_settings.fixedHeight | default: 400 %}
{% assign hide_desktop = theme_settings.hideDesktop | default: false %}
{% assign display_mode = theme_settings.displayMode | default: 'push' %}

{% if block.settings.hide_desktop or mobile_settings.hideDesktop or theme_settings.hideDesktop %}
<style>
  @media (min-width: 990px) {
    /* Masaüstünde Tüm Mega Menü Bloğunu Gizle */
    #mega-{{ block.id }},
    .mega-wrapper {
      display: none !important;
      visibility: hidden !important;
    }
  }
</style>
{% endif %}

{% assign mega_config = shop.metafields.breadcrumb.mega_menu_config.value %}
{% assign page_menu_map = shop.metafields.breadcrumb.page_menu_map.value %}
{% assign extra_menu_items = shop.metafields.breadcrumb.extra_menu_items.value %}
{% assign use_custom_root = block.settings.use_custom_root %}
{% assign auto_drill_down = block.settings.auto_context_root %}

{% assign nav_items = nil %}
{% assign matched_parent = nil %}

{% if use_custom_root %}
  {% assign custom_full_menu = shop.metafields.breadcrumb.custom_menu.value %}
  {% assign nav_items = custom_full_menu %}

  {% if auto_drill_down %}
    {% assign current_path = request.path | downcase %}
    {% assign found_mapping = nil %}
    
    {% comment %} 0. Product page: ALWAYS use product.collections first (priority) {% endcomment %}
    {% if template contains 'product' and product %}
      {% assign found_parent = nil %}
      {% for col in product.collections %}
        {% assign col_handle = col.handle %}
        {% for l1 in custom_full_menu %}
          {% if l1.handle == col_handle %}{% assign found_parent = l1 %}{% break %}{% endif %}
          {% for l2 in l1.children %}
            {% if l2.handle == col_handle %}{% assign found_parent = l1 %}{% break %}{% endif %}
            {% for l3 in l2.children %}
              {% if l3.handle == col_handle %}{% assign found_parent = l1 %}{% break %}{% endif %}
            {% endfor %}
            {% if found_parent %}{% break %}{% endif %}
          {% endfor %}
          {% if found_parent %}{% break %}{% endif %}
        {% endfor %}
        {% if found_parent %}{% break %}{% endif %}
      {% endfor %}
      {% if found_parent and found_parent.children.size > 0 %}
        {% assign allowed_drill_parents = "Bisiklet Sporu,Koşu Sporu,Yüzme Sporu,Beslenme" | split: "," %}
        {% if allowed_drill_parents contains found_parent.title %}
            {% assign nav_items = found_parent.children %}
        {% endif %}
        {% assign matched_parent = found_parent %}
      {% endif %}
    {% endif %}
    
    {% comment %} 1. Check manual page mappings (skip if product already matched) {% endcomment %}
    {% unless matched_parent %}
    {% for mapping in page_menu_map %}
       {% assign mapping_url = mapping.pageUrl | downcase %}
       {% assign mapping_url_clean = mapping_url | remove_first: '/' %}
       {% assign current_path_clean = current_path | remove_first: '/' %}
       
       {% if current_path_clean == mapping_url_clean %}
           {% assign found_mapping = mapping %}
           {% break %}
       {% elsif current_path contains mapping_url_clean and mapping_url_clean != '' and mapping_url_clean.size > 3 %}
           {% assign found_mapping = mapping %}
           {% break %}
       {% endif %}
    {% endfor %}
    {% endunless %}
    
    {% comment %} 2. If no manual mapping, use collection.handle to find parent in custom_menu (like breadcrumb) {% endcomment %}
    {% unless found_mapping %}
      {% if template contains 'collection' and collection %}
        {% assign col_handle = collection.handle %}
        {% assign found_parent = nil %}
        
        {% comment %} Search up to 6 levels deep in custom_menu to find collection {% endcomment %}
        {% for l1 in custom_full_menu %}
          {% comment %} Level 1 check {% endcomment %}
          {% if l1.handle == col_handle %}
            {% assign found_parent = l1 %}
            {% break %}
          {% endif %}
          
          {% if l1.children != blank %}
            {% for l2 in l1.children %}
              {% comment %} Level 2 check {% endcomment %}
              {% if l2.handle == col_handle %}
                {% assign found_parent = l1 %}
                {% break %}
              {% endif %}
              
              {% if l2.children != blank %}
                {% for l3 in l2.children %}
                  {% comment %} Level 3 check {% endcomment %}
                  {% if l3.handle == col_handle %}
                    {% assign found_parent = l1 %}
                    {% break %}
                  {% endif %}
                  
                  {% if l3.children != blank %}
                    {% for l4 in l3.children %}
                      {% comment %} Level 4 check {% endcomment %}
                      {% if l4.handle == col_handle %}
                        {% assign found_parent = l1 %}
                        {% break %}
                      {% endif %}
                      
                      {% if l4.children != blank %}
                        {% for l5 in l4.children %}
                          {% comment %} Level 5 check {% endcomment %}
                          {% if l5.handle == col_handle %}
                            {% assign found_parent = l1 %}
                            {% break %}
                          {% endif %}
                          
                          {% if l5.children != blank %}
                            {% for l6 in l5.children %}
                              {% comment %} Level 6 check {% endcomment %}
                              {% if l6.handle == col_handle %}
                                {% assign found_parent = l1 %}
                                {% break %}
                              {% endif %}
                            {% endfor %}
                          {% endif %}
                          {% if found_parent %}{% break %}{% endif %}
                        {% endfor %}
                      {% endif %}
                      {% if found_parent %}{% break %}{% endif %}
                    {% endfor %}
                  {% endif %}
                  {% if found_parent %}{% break %}{% endif %}
                {% endfor %}
              {% endif %}
              {% if found_parent %}{% break %}{% endif %}
            {% endfor %}
          {% endif %}
          {% if found_parent %}{% break %}{% endif %}
        {% endfor %}
        
        {% comment %} If found, use parent's children for menu {% endcomment %}
        {% if found_parent and found_parent.children.size > 0 %}
          {% assign allowed_drill_parents = "Bisiklet Sporu,Koşu Sporu,Yüzme Sporu,Beslenme" | split: "," %}
          {% if allowed_drill_parents contains found_parent.title %}
              {% assign nav_items = found_parent.children %}
          {% endif %}
          {% assign matched_parent = found_parent %}
        {% endif %}
      {% endif %}
    {% endunless %}
    
    {% comment %} 3. Apply found mapping {% endcomment %}
    {% if found_mapping and matched_parent == nil %}
        {% for item in custom_full_menu %}
            {% if item.title == found_mapping.menuTitle %}
                {% if item.children.size > 0 %}
                    {% assign allowed_drill_parents = "Bisiklet Sporu,Koşu Sporu,Yüzme Sporu,Beslenme" | split: "," %}
                    {% if allowed_drill_parents contains item.title %}
                        {% assign nav_items = item.children %}
                    {% endif %}
                    {% assign matched_parent = item %}
                {% endif %}
                {% break %}
            {% endif %}
        {% endfor %}
    {% endif %}
  {% endif %}

{% else %}
  {% assign nav_handle = block.settings.main_menu %}
  {% assign nav_items = linklists[nav_handle].links %}
{% endif %}


<div class="mega-wrapper {{ display_mode }}-mode {% if theme_settings.heightMode == 'fixed' %}fixed-height-mode{% endif %} {% if hide_desktop %}hide-desktop{% endif %}" id="mega-{{ block.id }}">

  <!-- DEBUG: template='{{ template }}' collection='{{ collection.handle }}' nav_items.size={{ nav_items.size }} matched_parent='{{ matched_parent.title }}' use_custom_root={{ use_custom_root }} auto_drill_down={{ auto_drill_down }} -->

  <!-- ÜST MENÜ -->
  <div class="mega-top">
    {% assign rendered_titles = "" %}
    {% assign priority_order = "Bisiklet Sporu,Koşu Sporu,Yüzme Sporu,Beslenme,Günlük Spor Giyim ve Aksesuar,Giyilebilir Teknolojiler,Sporcu Destek Ürünleri" | split: "," %}

    {% comment %} 1. Render Priority Items {% endcomment %}
    {% for priority_title in priority_order %}
      {% for link in nav_items %}
        {% if link.title == priority_title %}
          {% assign rendered_titles = rendered_titles | append: link.title | append: "|||" %}
          <a class="mega-top-item" 
             data-key="{{ link.title | handleize }}" 
             href="{{ link.url }}">
            {{ link.title }}
          </a>
          {% break %}
        {% endif %}
      {% endfor %}
    {% endfor %}

    {% comment %} 2. Render Remaining Items {% endcomment %}
    {% for link in nav_items %}
      {% if rendered_titles contains link.title %}{% continue %}{% endif %}
      {% assign rendered_titles = rendered_titles | append: link.title | append: "|||" %}
      <a class="mega-top-item" 
         data-key="{{ link.title | handleize }}" 
         href="{{ link.url }}">
        {{ link.title }}
      </a>
    {% endfor %}
    
    {% comment %} EXTRA MENU ITEMS (from admin panel metafield) {% endcomment %}
    {% if extra_menu_items != blank %}
        {% for extra_item in extra_menu_items %}
            {% if rendered_titles contains extra_item.menuTitle %}{% continue %}{% endif %}
            {% comment %} Find the menu item in custom_full_menu {% endcomment %}
            {% for menu_item in custom_full_menu %}
                {% if menu_item.title == extra_item.menuTitle %}
                    {% if extra_item.displayMode == 'parent' %}
                        {% comment %} Parent only - simple link, no dropdown {% endcomment %}
                        <a class="mega-top-item" 
                           href="{{ menu_item.url }}"
                           data-key="extra-{{ menu_item.title | handleize }}-parent">
                            {{ menu_item.title }}
                        </a>
                    {% else %}
                        {% comment %} Children mode - hoverable with dropdown {% endcomment %}
                        <a class="mega-top-item" 
                           data-key="extra-{{ menu_item.title | handleize }}" 
                           href="{{ menu_item.url }}">
                            {{ menu_item.title }}
                        </a>
                    {% endif %}
                    {% break %}
                {% endif %}
            {% endfor %}
        {% endfor %}
    {% endif %}
  </div>

  <!-- MEGA PANELS -->
  {% assign rendered_panels = "" %}
  
  {% comment %} 1. Priority Panels {% endcomment %}
  {% for priority_title in priority_order %}
    {% for link in nav_items %}
        {% if link.title == priority_title %}
            {% assign rendered_panels = rendered_panels | append: link.title | append: "|||" %}
            
            {% assign sub_level_items = nil %}
            {% assign matching_config = nil %}
            
            {% if link.children.size > 0 %}
                {% assign sub_level_items = link.children %}
            {% endif %}
        
            {% for item in mega_config %}
              {% if item.triggerTitle == link.title %}
                {% assign matching_config = item %}
                
                {% unless sub_level_items %}
                   {% if item.submenuHandle contains 'custom_special:' %}
                      {% assign target_title = item.submenuHandle | remove: 'custom_special:' %}
                      {% for c in custom_full_menu %}
                          {% if c.title == target_title %}{% assign sub_level_items = c.children %}{% endif %}
                      {% endfor %}
                   {% elsif item.submenuHandle != 'custom_menu_special' and item.submenuHandle != '' %}
                      {% assign sub_level_items = linklists[item.submenuHandle].links %}
                   {% endif %}
                {% endunless %}
                
                {% break %}
              {% endif %}
            {% endfor %}
        
            {% render 'mega_menu_panel', link: link, sub_level_items: sub_level_items, matching_config: matching_config, block: block, theme_settings: theme_settings %}

        {% endif %}
    {% endfor %}
  {% endfor %}

  {% comment %} 2. Remaining Panels {% endcomment %}
  {% for link in nav_items %}
     {% if rendered_panels contains link.title %}{% continue %}{% endif %}
    
    {% assign sub_level_items = nil %}
    {% assign matching_config = nil %}
    
    {% if link.children.size > 0 %}
        {% assign sub_level_items = link.children %}
    {% endif %}

    {% for item in mega_config %}
      {% if item.triggerTitle == link.title %}
        {% assign matching_config = item %}
        
        {% unless sub_level_items %}
           {% if item.submenuHandle contains 'custom_special:' %}
              {% assign target_title = item.submenuHandle | remove: 'custom_special:' %}
              {% for c in custom_full_menu %}
                  {% if c.title == target_title %}{% assign sub_level_items = c.children %}{% endif %}
              {% endfor %}
           {% elsif item.submenuHandle != 'custom_menu_special' and item.submenuHandle != '' %}
              {% assign sub_level_items = linklists[item.submenuHandle].links %}
           {% endif %}
        {% endunless %}
        
        {% break %}
      {% endif %}
    {% endfor %}

    {% render 'mega_menu_panel', link: link, sub_level_items: sub_level_items, matching_config: matching_config, block: block, theme_settings: theme_settings %}

  {% endfor %}

  {% comment %} PANELS FOR EXTRA MENU ITEMS (from admin panel) {% endcomment %}
  {% if extra_menu_items != blank %}
      {% for extra_item in extra_menu_items %}
          {% if rendered_panels contains extra_item.menuTitle %}{% continue %}{% endif %}
          
          {% comment %} Create panel for ALL extra items with children {% endcomment %}
          {% for menu_item in custom_full_menu %}
              {% if menu_item.title == extra_item.menuTitle and menu_item.children.size > 0 %}
                  
                  {% assign menu_handle = menu_item.title | handleize %}
                  
                  {% if extra_item.displayMode == 'parent' %}
                      {% assign custom_key = "extra-" | append: menu_handle | append: "-parent" %}
                  {% else %}
                      {% assign custom_key = "extra-" | append: menu_handle %}
                  {% endif %}

                  {% render 'mega_menu_panel', link: menu_item, sub_level_items: menu_item.children, matching_config: nil, block: block, theme_settings: theme_settings, custom_data_key: custom_key %}
                  
                  {% break %}
                  {% break %}
              {% endif %}
          {% endfor %}
      {% endfor %}
  {% endif %}

</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  console.log("Mega Menu JS v208 loaded");

  const wrapper = document.getElementById("mega-{{ block.id }}");
  if (!wrapper) return;
  
  const topItems = wrapper.querySelectorAll(".mega-top-item");
  const panels = wrapper.querySelectorAll(".mega-panel");

  /* PANEL AÇMA */
  function openPanel(key) {
    panels.forEach(p => {
      p.classList.toggle("active", p.dataset.key === key);
    });
    topItems.forEach(item => {
      item.classList.toggle("active", item.dataset.key === key);
    });
  }

  topItems.forEach(item => {
    item.addEventListener("mouseenter", () => {
      openPanel(item.dataset.key);
    });
  });

  wrapper.addEventListener("mouseleave", () => {
    panels.forEach(p => p.classList.remove("active"));
    topItems.forEach(item => item.classList.remove("active"));
  });

  /* ALT MENÜ OK AÇ/KAPA */
  wrapper.querySelectorAll(".mega-col-title .arrow").forEach(arrow => {
    arrow.addEventListener("click", function (e) {
      e.preventDefault();
      e.stopPropagation();
      this.closest(".mega-col").classList.toggle("open");
    });
  });

  /* DAHA FAZLA GÖSTER BUTTON */
  wrapper.querySelectorAll(".show-more-btn").forEach(btn => {
    btn.addEventListener("click", function(e) {
        e.preventDefault();
        e.stopPropagation();
        const col = this.closest(".mega-col");
        col.classList.toggle("expanded");
        
        const isExpanded = col.classList.contains("expanded");
        const count = this.innerText.match(/\d+/);
        const countStr = count ? `(${count[0]})` : "";
        
        if (isExpanded) {
            this.innerText = "Daha Az Göster ▲";
        } else {
            this.innerText = `Devamını Gör ${countStr} ▼`;
        }
    });
  });

  /* TEMA İKON MENÜSÜ AKTİF DURUMU (Web + Mobil) - URL tabanlı algılama */
  function applyActiveMenuState() {
    // URL'den kategori algıla
    const path = window.location.pathname.toLowerCase();
    const categoryMap = {
      'bisiklet': 'Bisiklet Sporu',
      'kosu': 'Koşu Sporu',
      'yuzme': 'Yüzme Sporu',
      'beslenme': 'Beslenme',
      'aksesuar': 'Günlük Spor Giyim ve Aksesuar',
      'teknoloji': 'Giyilebilir Teknolojiler',
      'destek': 'Sporcu Destek Ürünleri'
    };
    
    let activeCategory = null;
    for (const [key, value] of Object.entries(categoryMap)) {
      if (path.includes(key)) {
        activeCategory = value;
        break;
      }
    }
    
    // Eğer Liquid'den gelen değer varsa onu kullan
    {% if matched_parent %}
    activeCategory = "{{ matched_parent.title | escape }}";
    {% endif %}
    
    if (!activeCategory) return;
    
    const activeCategoryLower = activeCategory.toLowerCase();
    const firstWord = activeCategoryLower.split(' ')[0];
    
    // 1. WEB MENÜSÜ (.menu-item)
    document.querySelectorAll("li.active").forEach(li => { if (li.querySelector(".menu-item")) li.classList.remove("active"); });
    document.querySelectorAll(".menu-item").forEach(item => {
      const s = item.querySelector("span"); if (s) { s.style.color = ""; s.style.fontWeight = ""; }
      item.style.color = ""; item.classList.remove("breadcrumb-active-category");
      const img = item.querySelector("img"); if (img) img.style.filter = "";
    });
    
    document.querySelectorAll(".menu-item").forEach(item => {
      const spanText = item.querySelector("span");
      if (spanText) {
        const t = spanText.textContent.trim(); const tl = t.toLowerCase();
        const isMatch = (t===activeCategory || activeCategoryLower.includes(tl) || tl.includes(firstWord) || (firstWord.length>2 && firstWord.includes(tl)));
        if (isMatch) {
          const p = item.closest("li"); if (p) p.classList.add("active");
          item.classList.add("breadcrumb-active-category");
        }
      }
    });
    
    // 2. MOBİL MENÜSÜ (.mobile-category-item)
    document.querySelectorAll(".mobile-category-item").forEach(i => i.classList.remove("active"));
    let matchedHref = null;
    document.querySelectorAll(".mobile-category-item").forEach(item => {
      const s = item.querySelector("span");
      if (s) {
        const t = s.textContent.trim(); const tl = t.toLowerCase();
        const isMatch = (t===activeCategory || activeCategoryLower.includes(tl) || tl.includes(firstWord) || (firstWord.length>2 && firstWord.includes(tl)));
        if (isMatch) { item.classList.add("active"); matchedHref = item.getAttribute("href"); }
      }
    });
    
    // 3. LOCALSTORAGE
    if (matchedHref) localStorage.setItem("lastMainCategory", matchedHref);
  }
  
  setTimeout(applyActiveMenuState, 400); setTimeout(applyActiveMenuState, 800);
  window.addEventListener('pageshow', function(ev) { if (ev.persisted) setTimeout(applyActiveMenuState, 200); });

  /* ANASAYFA: Akış aktif */
  {% if template == 'index' %}
    localStorage.removeItem("lastMainCategory");
    function setAkis(){document.querySelectorAll("li.active,.mobile-category-item.active").forEach(e=>e.classList.remove("active"));document.querySelectorAll(".menu-item").forEach(e=>e.classList.remove("breadcrumb-active-category"));document.querySelectorAll(".menu-item,.mobile-category-item").forEach(e=>{const s=e.querySelector("span");if(s&&s.textContent.trim().toLowerCase()==="akış"){if(e.classList.contains("mobile-category-item"))e.classList.add("active");else{const p=e.closest("li");if(p)p.classList.add("active");e.classList.add("breadcrumb-active-category")}const h=e.getAttribute("href");if(h)localStorage.setItem("lastMainCategory",h)}});}
    setAkis();setTimeout(setAkis,100);setTimeout(setAkis,400);setTimeout(setAkis,800);
    window.addEventListener('pageshow',()=>{localStorage.removeItem("lastMainCategory");setAkis();setTimeout(setAkis,200);});
  {% endif %}

  {% assign mobile_groups = shop.metafields.breadcrumb.mobile_menu_groups.value %}
  
  /* MOBIL MENÜ: DİNAMİK (Compressed) */
  function restructureMobileMenu(){const c=document.querySelector('.mobile-category-bar');if(!c)return;const groups={{ mobile_groups | json }}||[];if(!groups.length)return;groups.forEach(g=>{if(c.querySelector(`[data-group-title="${g.groupTitle}"]`))return;const targets=g.childrenMenus||[];if(!targets.length)return;const ref=c.querySelector('li');if(!ref)return;const p=ref.cloneNode(!1);p.className='akis-parent-item custom-mobile-group';p.setAttribute('data-group-title',g.groupTitle);p.classList.remove('active');const l=document.createElement('a');l.href=g.groupLink||"/";l.className="mobile-category-item";l.innerHTML=`<span>${g.groupTitle}</span>`;const ar=document.createElement('span');ar.className='icon-arrow';ar.style.cssText="float:right;cursor:pointer;padding:0 10px;font-size:12px;";ar.innerHTML="▼";p.append(l,ar);const ul=document.createElement('ul');ul.className="mobile-sub-menu";ul.style.cssText="display:none;padding-left:20px;list-style:none;";const all=Array.from(c.querySelectorAll('li'));let m=0;all.forEach(li=>{if(li===p)return;const lnk=li.querySelector('.mobile-category-item');if(lnk&&targets.includes(lnk.textContent.trim())){ul.appendChild(li);m++}});if(m>0){p.appendChild(ul);c.prepend(p);ar.onclick=(e)=>{e.preventDefault();e.stopPropagation();const o=ul.style.display==="block";ul.style.display=o?"none":"block";ar.style.transform=o?"rotate(0deg)":"rotate(180deg)"}}})}setTimeout(restructureMobileMenu,500);setTimeout(restructureMobileMenu,1500);setTimeout(restructureMobileMenu,3000);
  
});
</script>

{% schema %}
{
  "name": "Mega Menu (Pro)",
  "target": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "use_custom_root",
      "label": "Uygulama Özel Menüsünü Kullan",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "auto_context_root",
      "label": "Sayfa-Menü Eşleştirmelerini Kullan",
      "default": true,
      "info": "Admin panelinde tanımladığınız sayfa-menü eşleştirmelerini kullanır."
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Ana Menü (Shopify)"
    },
    {
      "type": "header",
      "content": "Sol Görsel Ayarları"
    },
    {
      "type": "checkbox",
      "id": "show_sidebar_image",
      "label": "Sol Görsel Göster",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "sidebar_image",
      "label": "Sol Görsel",
      "info": "Panel açıldığında sol tarafta görünecek resim"
    },
    {
      "type": "header",
      "content": "⚠️ TEMA AYARLARI ⚠️",
      "info": "Menü yüksekliği, stili ve gelişmiş ayarlar artık uygulama yönetici panelinden yönetilmektedir. Blok ayarları geçersizdir."
    },
    {
      "type": "header",
      "content": "Legacy Settings (Deprecated)"
    },
    {
      "type": "select",
      "id": "height_mode",
      "label": "Menü Yüksekliği (Eski)",
      "options": [
        { "value": "auto", "label": "İçeriğe Göre" },
        { "value": "default", "label": "Varsayılan" }
      ],
      "default": "default"
    },
    {
      "type": "checkbox",
      "id": "hide_desktop",
      "label": "Masaüstünde Gizle (Eski)",
      "default": false
    }
  ]
}
{% endschema %}

<style>
  {% if theme_settings.heightMode == 'auto' or block.settings.height_mode == 'auto' %}
  /* İçeriğe göre yükseklik - tüm min-height kısıtlamaları kaldırıldı */
  #mega-{{ block.id }} .mega-panel {
    height: auto !important;
    min-height: 0 !important;
  }
  
  #mega-{{ block.id }} .mega-image {
    min-height: 0 !important;
    height: auto;
  }
  
  #mega-{{ block.id }} .mega-image img {
    position: relative;
    max-height: 250px;
    object-fit: cover;
  }
  {% endif %}
  
  {% if theme_settings.heightMode == 'fixed' %}
  /* SABİT YÜKSEKLİK MODU */
  #mega-{{ block.id }} .mega-panel {
    height: {{ theme_settings.fixedHeight | default: 400 }}px !important;
    overflow-y: hidden; /* Scrollbar'ı CSS ile yöneteceğiz, panel içinde */
    min-height: {{ theme_settings.fixedHeight | default: 400 }}px !important;
  }
  
  #mega-{{ block.id }} .mega-grid {
     height: 100%;
     overflow: hidden;
  }
  
  #mega-{{ block.id }} .mega-image {
     height: 100%;
     min-height: 100% !important;
  }
  
  #mega-{{ block.id }} .mega-image img {
     height: 100%;
     object-fit: cover;
  }
  
  #mega-{{ block.id }} .mega-cols {
      height: 100%;
      overflow-y: auto; /* Scroll burada olacak */
      padding-bottom: 20px;
  }
  {% endif %}
</style>


