{% schema %}
{
  "name": "Sepet Taksit Uyarısı",
  "target": "section",
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Arkaplan Rengi",
      "default": "#fff3cd"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Metin Rengi",
      "default": "#856404"
    },
    {
      "type": "text",
      "id": "default_message",
      "label": "Varsayılan Mesaj",
      "default": "Sepetinizdeki bazı ürünler nedeniyle taksit sayısı sınırlandırılmıştır."
    }
  ]
}
{% endschema %}

{% assign min_installments = 12 %}
{% assign restricted_cards = false %}
{% assign restricted_brand = "" %}

{% for item in cart.items %}
  {% assign vendor = item.product.vendor %}
  {% assign rule = shop.metaobjects.installment_rules[vendor] %}
  
  {% if rule %}
    {% assign limit = rule.max_installments.value %}
    {% if limit < min_installments %}
      {% assign min_installments = limit %}
      {% assign restricted_cards = true %}
      {% assign restricted_brand = vendor %}
    {% endif %}
  {% endif %}
{% endfor %}

{% if restricted_cards and min_installments < 12 %}
  <div class="installment-cart-warning" style="background-color: {{ section.settings.bg_color }}; color: {{ section.settings.text_color }};">
    <div class="warning-icon">⚠️</div>
    <div class="warning-text">
        <strong>Dikkat:</strong> 
        Sepetinizdeki <strong>{{ restricted_brand }}</strong> gibi ürünler sebebiyle, 
        ödeme ekranında en fazla <strong>{{ min_installments }} Taksit</strong> seçebilirsiniz.
    </div>
  </div>

  <style>
    .installment-cart-warning {
        padding: 12px 16px;
        margin-bottom: 16px;
        border-radius: 6px;
        border: 1px solid rgba(0,0,0,0.1);
        display: flex;
        align-items: flex-start;
        gap: 12px;
        font-size: 14px;
        line-height: 1.4;
    }
    .warning-icon {
        font-size: 18px;
    }
  </style>
{% endif %}
